:set -package transformers -hide-package hashmap
:set -fno-warn-overlapping-patterns -fwarn-unused-binds -fwarn-unused-imports
:load Main

:def test const $ return ":main test"

:def docs_ const $ return $ unlines [":!cabal configure",":!cabal haddock"]
:def docs const $ return $ unlines [":docs_",":!start dist\\doc\\html\\shake\\Development-Shake.html"]

:def hlint_ const $ return ":!hlint . --report"
:def hlint const $ return $ unlines [":hlint_",":!start report.html"]

:{
let _ghci_make name flags =
        ":!" ++
        "(if not exist output mkdir output) && " ++
        "(if not exist output\\obj mkdir output\\obj) && " ++
        "(if not exist output\\obj\\" ++ name ++ " mkdir output\\obj\\" ++ name ++ ") && " ++
        "ghc " ++ flags ++ " -hide-package hashmap -package transformers --make Main.hs -w -odir output/obj/" ++ name ++ " -hidir output/obj/" ++ name ++ " -o output/obj/" ++ name ++ "/shake.exe"
:}

:{
:def prof_ \x -> return $ unlines
        [_ghci_make "prof" "-rtsopts -threaded -prof -auto-all -caf-all"
        ,":!output\\obj\\prof\\shake " ++ x ++ " +RTS -p"
        ]
:}
:def prof \x -> return $ unlines [":prof_ " ++ x,":!start shake.prof"]
